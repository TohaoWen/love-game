<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¿ƒåŠ¨æŒ‘æˆ˜ï¼šç»™æœ€çˆ±çš„äºº â¤ï¸</title> 
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            font-family: "Microsoft YaHei", sans-serif; 
            touch-action: none; 
            /* æ¸å˜èƒŒæ™¯ */
            background: linear-gradient(135deg, #ffdee9 0%, #b5fffc 100%);
            color: #333;
        }
        #gameCanvas { display: block; margin: 0 auto; background: rgba(255, 255, 255, 0.3); }
        
        /* ç•Œé¢UIæ ·å¼ */
        .ui-layer { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            pointer-events: none; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 10;
        }
        
        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .info-bar { 
            position: absolute; 
            top: 15px; 
            width: 95%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }

        .score-board, .lives-board { 
            font-size: 20px; 
            font-weight: bold; 
            color: #880e4f; 
            background: rgba(255,255,255,0.9); 
            padding: 5px 15px; 
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* å¼¹çª—æ ·å¼ */
        #startScreen, #gameOverScreen, #winScreen { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 30px 40px; 
            border-radius: 20px; 
            text-align: center; 
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.5); 
            pointer-events: auto;
            max-width: 90%;
            border: 3px solid #ff6b81;
        }
        
        h1 { color: #ff3366; margin-bottom: 10px; font-size: 28px; }
        p { color: #666; font-size: 18px; line-height: 1.5; }
        
        .btn { 
            background: linear-gradient(45deg, #ff6b81, #ff4757); 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            font-size: 18px; 
            border-radius: 50px; 
            margin-top: 20px; 
            cursor: pointer; 
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div class="info-bar">
        <div class="score-board">çˆ±æ„å€¼: <span id="scoreVal">0</span></div>
        <div class="lives-board">ç”Ÿå‘½å€¼: <span id="livesVal">â¤ï¸â¤ï¸â¤ï¸</span></div>
    </div>

    <div id="startScreen" class="ui-layer">
        <div>
            <h1>å¿ƒåŠ¨æŒ‘æˆ˜ï¼šç»™æœ€å¯çˆ±çš„ä½  â¤ï¸</h1>
            <p>ğŸ’– ç›®æ ‡ï¼šé›†æ»¡ 520 åˆ†ï¼</p>
            <p>ğŸ’§ è­¦å‘Šï¼šæ¥åˆ°åè¿æ°”ä¼šæ‰£åˆ†ä¸”æŸå¤±ç”Ÿå‘½ã€‚</p>
            <p>ğŸ•¹ï¸ æ“ä½œï¼šç‚¹å‡»å±å¹•å·¦å³æ»‘åŠ¨å°ç¯®å­ã€‚</p>
            <button class="btn" onclick="startGame()">å¼€å§‹æŒ‘æˆ˜</button>
        </div>
    </div>

    <div id="winScreen" class="ui-layer hidden">
        <div>
            <h1>ğŸ‰ ä½ å¤ªæ£’äº†ï¼æˆ‘ä»¬èƒœåˆ©äº†! ğŸ‰</h1>
            <p>ä½ çš„çˆ±æ„å€¼å·²ç»çˆ†è¡¨ï¼<br>æˆ‘ä¸ºä½ éª„å‚²ï¼ğŸ˜˜</p>
            <p style="font-size: 40px; margin: 15px;">ğŸ’–</p>
            <button class="btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <div id="gameOverScreen" class="ui-layer hidden">
        <div>
            <h1>ğŸ’” æŒ‘æˆ˜å¤±è´¥</h1>
            <p>ä¸å°å¿ƒè¢«åè¿æ°”å‡»è´¥äº†...<br>å†è¯•ä¸€æ¬¡ï¼ŒæŠŠæ‰€æœ‰çˆ±æ„æ¥ä½ï¼</p>
            <button class="btn" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let w, h;
        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- æ¸¸æˆé…ç½® ---
        const CONFIG = {
            winScore: 520,     // è·èƒœåˆ†æ•°
            maxLives: 3,       // åˆå§‹ç”Ÿå‘½å€¼
            baseSpeed: 2,      // åŸºç¡€é€Ÿåº¦
            speedMultiplier: 0.005, // åŠ¨æ€åŠ é€Ÿå› å­
        };

        // --- æ¸¸æˆçŠ¶æ€ ---
        let state = {
            score: 0,
            lives: CONFIG.maxLives,
            running: false,
            items: [],
            player: { x: w/2, y: h - 100, size: 60 } // ç©å®¶ (å°ç¯®å­)
        };

        // --- é“å…·å®šä¹‰ ---
        const ITEM_TYPES = [
            { type: 'GOOD', emoji: 'â¤ï¸', score: 10, speed: 1.5, size: 35 },
            { type: 'GOOD', emoji: 'ğŸŒŸ', score: 15, speed: 1.8, size: 30 },
            { type: 'BAD', emoji: 'ğŸ’§', score: -30, speed: 2.2, size: 35 } // è´Ÿé¢æƒ…ç»ª
        ];

        // ç©å®¶è´´å›¾ï¼ˆå°ç¯®å­ï¼‰
        const PLAYER_EMOJI = "ğŸ§º"; 

        // æ ¸å¿ƒå¾ªç¯
        function loop() {
            if (!state.running) return;
            
            ctx.clearRect(0, 0, w, h);
            
            // 1. åŠ¨æ€éš¾åº¦è®¡ç®—
            // éšç€åˆ†æ•°å¢åŠ ï¼Œéš¾åº¦ç³»æ•°è¶Šé«˜ (baseSpeed + score * multiplier)
            let difficultyFactor = 1 + state.score * CONFIG.speedMultiplier; 

            // 2. é“å…·ç”Ÿæˆ (åŸºäºéš¾åº¦ç³»æ•°è°ƒæ•´é¢‘ç‡)
            if (Math.random() * 100 < 6 * difficultyFactor) { 
                // å¢åŠ ç”Ÿæˆé¢‘ç‡
                const itemDef = ITEM_TYPES[Math.floor(Math.random() * ITEM_TYPES.length)];
                spawnItem(itemDef, difficultyFactor);
            }

            // 3. æ›´æ–°æ‰€æœ‰æ‰è½ç‰©
            for (let i = 0; i < state.items.length; i++) {
                let item = state.items[i];
                item.y += item.speed * difficultyFactor;
                
                // ç»˜åˆ¶æ‰è½ç‰©
                ctx.font = `${item.size}px Arial`;
                ctx.textAlign = "center";
                ctx.fillText(item.emoji, item.x, item.y);

                // ç¢°æ’æ£€æµ‹
                let dx = item.x - state.player.x;
                let dy = item.y - state.player.y; 
                let distance = Math.sqrt(dx*dx + dy*dy);

                if (distance < 50) { // ç©å®¶æ¥ä½äº†
                    handleCollision(item);
                    state.items.splice(i, 1);
                    i--;
                } else if (item.y > h) { // æ‰å‡ºå±å¹•
                    handleMiss(item);
                    state.items.splice(i, 1);
                    i--;
                }
            }

            // 4. ç»˜åˆ¶ç©å®¶
            ctx.font = `${state.player.size}px Arial`;
            ctx.textAlign = "center";
            ctx.fillText(PLAYER_EMOJI, state.player.x, state.player.y);

            requestAnimationFrame(loop);
        }

        // --- æ¸¸æˆé€»è¾‘å‡½æ•° ---
        
        function handleCollision(item) {
            state.score += item.score;
            if(state.score < 0) state.score = 0; // åˆ†æ•°ä¸èƒ½ä¸ºè´Ÿ
            document.getElementById('scoreVal').innerText = state.score;

            if (item.type === 'BAD') {
                // æ¥åˆ°è´Ÿé¢æƒ…ç»ªï¼šæ‰£é™¤ç”Ÿå‘½
                state.lives -= 1;
                updateLivesDisplay();
            }

            checkStatus();
        }
        
        function handleMiss(item) {
            if (item.type === 'GOOD') {
                // æ¼æ¥çˆ±å¿ƒï¼šæ‰£é™¤ç”Ÿå‘½
                state.lives -= 1;
                updateLivesDisplay();
            }
            checkStatus();
        }

        function spawnItem(itemDef, factor) {
            state.items.push({
                type: itemDef.type,
                emoji: itemDef.emoji,
                score: itemDef.score,
                size: itemDef.size,
                x: Math.random() * (w - 60) + 30,
                y: -30,
                speed: itemDef.speed * factor + CONFIG.baseSpeed
            });
        }
        
        function updateLivesDisplay() {
            const livesDiv = document.getElementById('livesVal');
            livesDiv.innerHTML = 'â¤ï¸'.repeat(state.lives);
            if(state.lives <= 1) {
                livesDiv.style.color = 'red'; // å±é™©æç¤º
            } else {
                livesDiv.style.color = '#880e4f';
            }
        }

        function checkStatus() {
            if (state.score >= CONFIG.winScore) {
                state.running = false;
                document.getElementById('winScreen').classList.remove('hidden');
            } else if (state.lives <= 0) {
                state.running = false;
                document.getElementById('gameOverScreen').classList.remove('hidden');
            }
        }

        // --- æµç¨‹æ§åˆ¶ ---
        
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('winScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            state.score = 0;
            state.lives = CONFIG.maxLives;
            state.items = [];
            state.running = true;
            
            document.getElementById('scoreVal').innerText = 0;
            updateLivesDisplay();
            loop();
        }

        function resetGame() {
            startGame();
        }

        // --- æ§åˆ¶é€»è¾‘ (è§¦æ‘¸/é¼ æ ‡) ---
        canvas.addEventListener('touchmove', function(e) {
            if (!state.running) return;
            e.preventDefault(); 
            let touch = e.touches[0];
            // ç¡®ä¿ç©å®¶åœ¨å±å¹•å†…
            state.player.x = Math.max(state.player.size/2, Math.min(w - state.player.size/2, touch.clientX));
        }, { passive: false });

        canvas.addEventListener('mousemove', function(e) {
            if(state.running) state.player.x = e.clientX;
        });

    </script>
</body>
</html>
