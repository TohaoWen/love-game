<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç»™æœ€å¯çˆ±çš„ä½  â¤ï¸</title> <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: #ffeef0; font-family: "Microsoft YaHei", sans-serif; touch-action: none; }
        #gameCanvas { display: block; margin: 0 auto; }

        /* ç•Œé¢UIæ ·å¼ */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .score-board { position: absolute; top: 20px; left: 20px; font-size: 20px; font-weight: bold; color: #ff6b81; background: rgba(255,255,255,0.8); padding: 5px 15px; border-radius: 20px; }

        /* å¼€å§‹å’Œç»“æŸçš„å¼¹çª— */
        #startScreen, #gameOverScreen, #winScreen {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
            pointer-events: auto;
            max-width: 80%;
        }

        h1 { color: #ff3366; margin-bottom: 10px; font-size: 24px; }
        p { color: #666; font-size: 16px; line-height: 1.5; }

        .btn {
            background: linear-gradient(45deg, #ff6b81, #ff4757);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            border-radius: 50px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }

        /* éšè—å…ƒç´  */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div class="score-board">çˆ±æ„å€¼: <span id="scoreVal">0</span></div>

    <div id="startScreen" class="ui-layer">
        <h1>â¤ï¸ çˆ±çš„æ¥åŠ›æŒ‘æˆ˜ â¤ï¸</h1>
        <p>æ§åˆ¶å°äººå·¦å³ç§»åŠ¨<br>æ¥ä½æ‰è½çš„çˆ±å¿ƒ</p>
        <p>ç›®æ ‡ï¼šé›†æ»¡ 520 åˆ†</p>
        <button class="btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <div id="winScreen" class="ui-layer hidden">
        <h1>ğŸ‰ æŒ‘æˆ˜æˆåŠŸ! ğŸ‰</h1>
        <p>æˆ‘å°±çŸ¥é“ä½ æœ€æ£’äº†ï¼<br>æ¥ä¸‹æ¥çš„æ—¥å­ä¹Ÿè¦å¼€å¿ƒå“¦~</p>
        <p style="font-size: 40px; margin: 10px;">ğŸ˜˜</p>
        <button class="btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>

    <div id="gameOverScreen" class="ui-layer hidden">
        <h1>ğŸ’” æ¼æ‰å¤ªå¤šå•¦</h1>
        <p>ä¸è¦ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼</p>
        <button class="btn" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // è‡ªé€‚åº”å±å¹•
        let w, h;
        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // æ¸¸æˆé…ç½®
        const CONFIG = {
            playerSpeed: 10,  // ç”µè„‘ç«¯æŒ‰é”®ç§»åŠ¨é€Ÿåº¦
            spawnRate: 30,    // çˆ±å¿ƒç”Ÿæˆé¢‘ç‡
            winScore: 520     // è·èƒœåˆ†æ•°
        };

        // æ¸¸æˆçŠ¶æ€
        let state = {
            score: 0,
            running: false,
            hearts: [],
            player: { x: w/2, y: h - 100, size: 50 } // ç©å®¶åˆå§‹ä½ç½®
        };

        // ç©å®¶è´´å›¾ï¼ˆç”¨Emojiï¼‰
        const PLAYER_EMOJI = "ğŸ§‘"; // è¿™é‡Œå¯ä»¥æ”¹æˆ ğŸ‘¦ æˆ– ğŸ‘§
        const HEART_EMOJI = "â¤ï¸";
        const BOMB_EMOJI = "ğŸ˜ "; // å¹²æ‰°é¡¹

        // æ ¸å¿ƒå¾ªç¯
        function loop() {
            if (!state.running) return;

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, w, h);

            // 1. ç”Ÿæˆçˆ±å¿ƒ (éšæœºæ¦‚ç‡)
            if (Math.random() * 100 < 5) { // 5%æ¦‚ç‡æ¯å¸§ç”Ÿæˆ
                spawnItem(HEART_EMOJI, 3 + Math.random() * 3, 10); // é€Ÿåº¦3-6ï¼Œåˆ†å€¼10
            }
            // ç”Ÿæˆå¹²æ‰°é¡¹ (å¶å°”å‡ºç°)
            if (Math.random() * 100 < 1) {
                spawnItem(BOMB_EMOJI, 4 + Math.random() * 4, -20); // æ‰£åˆ†
            }

            // 2. æ›´æ–°æ‰€æœ‰æ‰è½ç‰©
            for (let i = 0; i < state.hearts.length; i++) {
                let item = state.hearts[i];
                item.y += item.speed;

                // ç»˜åˆ¶æ‰è½ç‰©
                ctx.font = "30px Arial";
                ctx.textAlign = "center";
                ctx.fillText(item.type, item.x, item.y);

                // ç¢°æ’æ£€æµ‹
                let dx = item.x - state.player.x;
                let dy = item.y - (state.player.y - 30); // ç¨å¾®å‘ä¸Šè°ƒæ•´ç¢°æ’ç‚¹
                let distance = Math.sqrt(dx*dx + dy*dy);

                if (distance < 40) { // ç¢°åˆ°ç©å®¶
                    state.score += item.score;
                    if(state.score < 0) state.score = 0; // ä¸å…è®¸è´Ÿåˆ†
                    document.getElementById('scoreVal').innerText = state.score;

                    // ç‰¹æ•ˆï¼šç®€å•çš„æ–‡å­—æ”¾å¤§æç¤ºï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

                    state.hearts.splice(i, 1);
                    i--;
                    checkWin();
                } else if (item.y > h) { // æ‰å‡ºå±å¹•
                    state.hearts.splice(i, 1);
                    i--;
                }
            }

            // 3. ç»˜åˆ¶ç©å®¶
            ctx.font = "50px Arial";
            ctx.textAlign = "center";
            ctx.fillText(PLAYER_EMOJI, state.player.x, state.player.y);

            requestAnimationFrame(loop);
        }

        function spawnItem(type, speed, score) {
            state.hearts.push({
                type: type,
                x: Math.random() * (w - 60) + 30, // é¿å…å¤ªé è¾¹
                y: -30,
                speed: speed,
                score: score
            });
        }

        function checkWin() {
            if (state.score >= CONFIG.winScore) {
                state.running = false;
                document.getElementById('winScreen').classList.remove('hidden');
                drawFireworks(); // ç®€å•çš„åº†ç¥èƒŒæ™¯ï¼ˆç®€å•ç‰ˆä¸åšå¤æ‚ç²’å­ï¼‰
            }
        }

        // --- æ§åˆ¶é€»è¾‘ ---

        // è§¦æ‘¸æ§åˆ¶ (æ‰‹æœºæ ¸å¿ƒ)
        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault(); // é˜²æ­¢æ»šåŠ¨å±å¹•
            let touch = e.touches[0];
            state.player.x = touch.clientX;
        }, { passive: false });

        // é¼ æ ‡æ§åˆ¶ (ç”µè„‘æµ‹è¯•)
        canvas.addEventListener('mousemove', function(e) {
            if(state.running) state.player.x = e.clientX;
        });

        // æµç¨‹æ§åˆ¶
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            state.score = 0;
            state.hearts = [];
            state.running = true;
            document.getElementById('scoreVal').innerText = 0;
            loop();
        }

        function resetGame() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            startGame();
        }

    </script>
</body>
</html>
